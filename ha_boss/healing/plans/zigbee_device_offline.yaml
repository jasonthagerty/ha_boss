name: zigbee_device_offline
version: 1
description: "Healing plan for Zigbee devices that go offline or become unavailable"
enabled: true
priority: 50

match:
  entity_patterns:
    - "light.zigbee_*"
    - "sensor.zigbee_*"
    - "switch.zigbee_*"
    - "binary_sensor.zigbee_*"
  integration_domains:
    - "zha"
    - "zigbee2mqtt"
    - "deconz"
  failure_types:
    - "unavailable"
    - "unknown"

steps:
  - name: "retry_service_call"
    level: "entity"
    action: "retry_service_call"
    params:
      max_attempts: 3
      base_delay_seconds: 1.0
    timeout_seconds: 15

  - name: "reconnect_device"
    level: "device"
    action: "reconnect"
    params:
      wait_after_seconds: 3.0
    timeout_seconds: 20

  - name: "reload_integration"
    level: "integration"
    action: "reload_integration"
    params:
      wait_after_seconds: 5.0
    timeout_seconds: 30

on_failure:
  escalate: true
  cooldown_seconds: 600

tags:
  - "zigbee"
  - "connectivity"
